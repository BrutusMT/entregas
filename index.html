<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Rota PrioritÃ¡ria â€“ App de Entregas</title>

<style>
:root{
    --bg:#121212;
    --card:#1e1e1e;
    --header:#1f1f1f;
    --alta:#b71c1c;
    --media:#f57f17;
    --baixa:#1b5e20;
    --ok:#4caf50;
    --edit:#1976d2;
    --del:#c62828;
}
body{margin:0;font-family:Arial,Helvetica,sans-serif;background:var(--bg);color:#fff}
header{background:var(--header);padding:15px;text-align:center;font-size:20px;font-weight:bold}
.container{padding:15px}
.section{background:var(--card);padding:15px;border-radius:8px;margin-bottom:20px}
input,select,button{width:100%;padding:10px;margin-top:10px;border:none;border-radius:5px}
button{background:var(--ok);color:#fff;font-weight:bold;cursor:pointer}
.cards{display:flex;flex-direction:column;gap:10px}
.card{padding:15px;border-radius:8px;position:relative}
.prioridade-alta{background:var(--alta)}
.prioridade-media{background:var(--media)}
.prioridade-baixa{background:var(--baixa)}
.actions{position:absolute;top:10px;right:10px;display:flex;gap:5px}
.actions button{width:auto;padding:5px 8px;font-size:12px}
.btn-edit{background:var(--edit)}
.btn-del{background:var(--del)}
#map{width:100%;height:280px;border-radius:8px;border:none}
.modal{display:none;position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,.8);align-items:center;justify-content:center;z-index:10}
.modal-content{background:#1e1e1e;width:90%;max-height:80%;overflow-y:auto;padding:15px;border-radius:8px}
.stats{display:flex;gap:10px;margin-bottom:15px}
.stat{flex:1;background:#000;padding:10px;border-radius:6px;text-align:center}
</style>
</head>
<body>

<header>ğŸšš Rota PrioritÃ¡ria â€“ Entregador</header>

<div class="container">

<div class="stats">
    <div class="stat">â³ Pendentes<br><strong id="pendentes">0</strong></div>
    <div class="stat">âœ… Finalizadas<br><strong id="finalizadas">0</strong></div>
</div>

<div class="section">
    <h3>â• Nova Entrega</h3>
    <form id="formEntrega">
        <input type="text" id="nome" placeholder="Nome do cliente" required>
        <input type="text" id="endereco" placeholder="EndereÃ§o completo" required>
        <input type="text" id="cep" placeholder="CEP (somente nÃºmeros)" required>
        <select id="prioridade">
            <option value="3">Alta prioridade</option>
            <option value="2">MÃ©dia prioridade</option>
            <option value="1">Baixa prioridade</option>
        </select>
        <button type="submit">Adicionar Entrega</button>
    </form>
</div>

<div class="section">
    <h3>ğŸ” Filtrar por CEP</h3>
    <input type="text" id="filtroCep" placeholder="Digite o CEP" oninput="atualizarLista()">
</div>

<div class="cards" id="listaEntregas"></div>

<div class="section">
    <h3>ğŸ“¦ Entregas ConcluÃ­das</h3>
    <button onclick="abrirHistorico()">Ver HistÃ³rico</button>
</div>

<div class="section">
    <h3>ğŸ—ºï¸ Mapa da Rota</h3>
    <iframe id="map" loading="lazy"></iframe>
</div>

</div>

<div class="modal" id="modalHistorico">
    <div class="modal-content">
        <h3>ğŸ“œ HistÃ³rico de Entregas</h3>
        <div id="listaHistorico"></div>
        <button onclick="fecharHistorico()">Fechar</button>
    </div>
</div>

<script>
let entregas = JSON.parse(localStorage.getItem('entregas')) || [];
let historico = JSON.parse(localStorage.getItem('historico')) || [];

function atualizarStats(){
    document.getElementById('pendentes').textContent = entregas.length;
    document.getElementById('finalizadas').textContent = historico.length;
}

function atualizarLista(){
    const lista=document.getElementById('listaEntregas');
    const filtro=document.getElementById('filtroCep').value;
    lista.innerHTML='';

    const listaFiltrada = entregas
        .map((e,index)=>({ ...e, _index:index }))
        .filter(e=>!filtro || e.cep.includes(filtro));

    listaFiltrada.forEach(e=>{
        const classe=e.prioridade==3?'prioridade-alta':e.prioridade==2?'prioridade-media':'prioridade-baixa';
        const card=document.createElement('div');
        card.className=`card ${classe}`;
        card.innerHTML=`
            <div class="actions">
                <button class="btn-edit" onclick="editarEntrega(${e._index})">âœï¸</button>
                <button class="btn-del" onclick="excluirEntrega(${e._index})">ğŸ—‘ï¸</button>
            </div>
            <strong>${e.nome}</strong><br>
            <small>${e.endereco}</small><br>
            CEP: ${e.cep}<br>
            <button onclick="abrirMapa('${e.endereco}')">Iniciar rota</button>
            <button onclick="finalizar(${e._index})">Marcar como entregue</button>`;
        lista.appendChild(card);
    });
    atualizarStats();
}

function editarEntrega(i){
    const e=entregas[i];
    const nome=prompt('Nome',e.nome);
    if(!nome) return;
    const endereco=prompt('EndereÃ§o',e.endereco);
    const cep=prompt('CEP',e.cep);
    e.nome=nome; e.endereco=endereco; e.cep=cep;
    salvar();
}

function excluirEntrega(i){
    if(confirm('Excluir esta entrega?')){
        entregas.splice(i,1);
        salvar();
    }
}

function finalizar(i){
    const e=entregas[i];
    e.data=new Date().toLocaleString();
    historico.push(e);
    entregas.splice(i,1);
    salvar();
}

function abrirHistorico(){
    const lista=document.getElementById('listaHistorico');
    lista.innerHTML='';
    historico.forEach((e,i)=>{
        const div=document.createElement('div');
        div.className='section';
        div.innerHTML=`
            <div class="actions">
                <button class="btn-edit" onclick="editarHistorico(${i})">âœï¸</button>
                <button class="btn-del" onclick="excluirHistorico(${i})">ğŸ—‘ï¸</button>
            </div>
            <strong>${e.nome}</strong><br>${e.endereco}<br>CEP: ${e.cep}<br><small>${e.data}</small>`;
        lista.appendChild(div);
    });
    document.getElementById('modalHistorico').style.display='flex';
}

function editarHistorico(i){
    const e=historico[i];
    const nome=prompt('Nome',e.nome);
    if(!nome) return;
    e.nome=nome;
    salvar();
    abrirHistorico();
}

function excluirHistorico(i){
    if(confirm('Excluir do histÃ³rico?')){
        historico.splice(i,1);
        salvar();
        abrirHistorico();
    }
}

function fecharHistorico(){
    document.getElementById('modalHistorico').style.display='none';
}

function abrirMapa(end){
    document.getElementById('map').src=`https://www.google.com/maps?q=${encodeURIComponent(end)}&output=embed`;
}

function salvar(){
    localStorage.setItem('entregas',JSON.stringify(entregas));
    localStorage.setItem('historico',JSON.stringify(historico));
    atualizarLista();
}

const formEntrega=document.getElementById('formEntrega');
formEntrega.addEventListener('submit', ev=>{
    ev.preventDefault();
    const nomeVal=document.getElementById('nome').value;
    const enderecoVal=document.getElementById('endereco').value;
    const cepVal=document.getElementById('cep').value;
    const prioridadeVal=parseInt(document.getElementById('prioridade').value);

    entregas.push({
        nome:nomeVal,
        endereco:enderecoVal,
        cep:cepVal,
        prioridade:prioridadeVal
    });
    salvar();
    formEntrega.reset();
});

atualizarLista();
</script>
</body>
</html>
